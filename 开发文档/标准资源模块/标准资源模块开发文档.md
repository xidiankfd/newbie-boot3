# 标准资源模块开发文档

## 📋 项目概述

基于PostgreSQL数据库脚本设计的标准资源管理模块，采用SpringBoot 3 + MyBatis-Plus架构，提供标准资源的全生命周期管理功能。

## 🏗️ 模块架构

### 核心功能模块
- **标准资源主表管理** - 标准基本信息的CRUD操作
- **标准资源附件管理** - 数字化内容文件管理
- **术语定义管理** - 标准术语词典管理
- **引用关联管理** - 标准间引用关系维护
- **解读信息管理** - 标准解读文档管理

### 技术栈
- **后端框架**: Spring Boot 3.2.4 + Java 21
- **数据访问**: MyBatis-Plus 3.5.5
- **权限控制**: Sa-Token 1.37.0
- **API文档**: Knife4j + OpenAPI 3.0
- **数据库**: PostgreSQL (兼容MySQL)

## 📁 模块结构

```
newbie-standard/                     # 标准资源模块
├── src/main/java/com/newbie/standard/
│   ├── domain/
│   │   ├── entity/                  # 实体类
│   │   │   ├── StdResource.java
│   │   │   ├── StdResourceAttachment.java
│   │   │   ├── StdTerminology.java
│   │   │   ├── StdResourceReference.java
│   │   │   └── StdInterpretation.java
│   │   ├── dto/                     # 数据传输对象
│   │   └── vo/                      # 视图对象
│   ├── mapper/                      # 数据访问层
│   │   ├── StdResourceMapper.java
│   │   ├── StdResourceAttachmentMapper.java
│   │   ├── StdTerminologyMapper.java
│   │   ├── StdResourceReferenceMapper.java
│   │   └── StdInterpretationMapper.java
│   └── service/                     # 业务服务层
│       ├── StdResourceService.java
│       ├── StdResourceAttachmentService.java
│       ├── StdTerminologyService.java
│       ├── StdResourceReferenceService.java
│       ├── StdInterpretationService.java
│       └── impl/                    # 服务实现
│           ├── StdResourceServiceImpl.java
│           ├── StdResourceAttachmentServiceImpl.java
│           ├── StdTerminologyServiceImpl.java
│           ├── StdResourceReferenceServiceImpl.java
│           └── StdInterpretationServiceImpl.java
└── src/main/resources/
    └── mapper/                      # MyBatis XML映射文件

newbie-admin/src/main/java/com/newbie/controller/standard/  # 控制器层
├── StdResourceController.java
├── StdResourceAttachmentController.java
├── StdTerminologyController.java
├── StdResourceReferenceController.java
└── StdInterpretationController.java
```

## 🗄️ 数据库设计

### 核心数据表

#### 1. std_resource (标准资源主表)
- **功能**: 存储标准的基本信息
- **核心字段**: resource_code(标准编号)、chinese_name(标准名称)、standard_status(状态)等
- **特点**: 支持多种标准类型和状态管理

#### 2. std_resource_attachment (标准资源附件表)
- **功能**: 存储标准的数字化内容文件
- **核心字段**: attachment_name(文件名)、file_size(文件大小)、is_main_file(主文件标识)等
- **特点**: 支持多种文件类型和主文件标识

#### 3. std_terminology (术语定义表)
- **功能**: 存储标准中的术语和定义
- **核心字段**: term_name(术语)、english_term(英文对应词)、definition(定义)等
- **特点**: 支持术语分类和排序

#### 4. std_resource_reference (标准资源引用关联表)
- **功能**: 存储标准之间的引用关系
- **核心字段**: reference_type(引用类型)、reference_name(引用文件名)等
- **特点**: 支持"引用"和"被引用"双向关系

#### 5. std_interpretation (文件解读信息表)
- **功能**: 存储标准的解读文档信息
- **核心字段**: source_title(解读标题)、source_type(来源类型)、is_official(官方标识)等
- **特点**: 支持查看次数统计和官方解读标识

## 🔧 核心功能实现

### 1. 标准资源管理
```java
// 分页查询标准资源
@GetMapping("/page")
public R<Page<StdResource>> page(@RequestParam Integer current, 
                                @RequestParam Integer size, 
                                StdResource stdResource)

// 根据标准编号查询
@GetMapping("/code/{resourceCode}")
public R<StdResource> getByResourceCode(@PathVariable String resourceCode)
```

### 2. 附件管理
```java
// 根据资源ID查询附件列表
@GetMapping("/listByResourceId/{resourceId}")
public R<List<StdResourceAttachment>> listByResourceId(@PathVariable String resourceId)

// 查询主文件
@GetMapping("/mainFile/{resourceId}")
public R<StdResourceAttachment> getMainFileByResourceId(@PathVariable String resourceId)
```

### 3. 术语管理
```java
// 根据资源ID查询术语列表(按排序)
@GetMapping("/listOrderBySort/{resourceId}")
public R<List<StdTerminology>> listByResourceIdOrderBySort(@PathVariable String resourceId)

// 批量导入术语
@PostMapping("/batchImport")
public R<Object> batchImport(@RequestBody List<StdTerminology> terminologyList)
```

### 4. 引用关系管理
```java
// 查询引用了指定资源的其他标准
@GetMapping("/listByReferenceId/{referenceId}")
public R<List<StdResourceReference>> listByReferenceId(@PathVariable String referenceId)

// 统计引用数量
@GetMapping("/count")
public R<Long> countByResourceIdAndType(@RequestParam String resourceId, 
                                       @RequestParam String referenceType)
```

### 5. 解读信息管理
```java
// 查询官方解读
@GetMapping("/listOfficial/{resourceId}")
public R<List<StdInterpretation>> listOfficialByResourceId(@PathVariable String resourceId)

// 根据标题搜索解读
@GetMapping("/listByTitle")
public R<List<StdInterpretation>> listByTitleLike(@RequestParam String title)
```

## 🔒 权限控制

### 权限点设计
- **standard:resource:*** - 标准资源权限
- **standard:attachment:*** - 附件管理权限
- **standard:terminology:*** - 术语管理权限
- **standard:reference:*** - 引用关系权限
- **standard:interpretation:*** - 解读信息权限

### 权限粒度
- **list** - 列表查询权限
- **query** - 详情查询权限
- **add** - 新增权限
- **update** - 修改权限
- **delete** - 删除权限
- **import** - 导入权限

## 🚀 部署配置

### 1. 数据库初始化
执行PostgreSQL初始化脚本：
```sql
-- 执行完整的数据库初始化脚本
\i 标准资源模块-PostgreSQL初始化.sql
```

### 2. 依赖配置
在主应用模块添加标准资源模块依赖：
```xml
<dependency>
    <groupId>com.newbie</groupId>
    <artifactId>newbie-standard</artifactId>
    <version>${project.version}</version>
</dependency>
```

### 3. 包扫描配置
确保包扫描包含标准资源模块：
```java
@ComponentScan(basePackages = {"com.newbie"})
@MapperScan("com.newbie.**.mapper")
```

## 📊 API接口文档

所有接口均支持Swagger/OpenAPI 3.0文档，通过以下标签分组：

- **标准资源管理** - `/standard/resource/**`
- **标准资源附件管理** - `/standard/attachment/**`  
- **术语定义管理** - `/standard/terminology/**`
- **标准资源引用关联管理** - `/standard/reference/**`
- **文件解读信息管理** - `/standard/interpretation/**`

### 主要API示例

#### 标准资源查询
```http
GET /standard/resource/page?current=1&size=10&standardStatus=现行
```

#### 术语导入
```http
POST /standard/terminology/batchImport
Content-Type: application/json

[{
  "resourceId": "1",
  "termName": "基本数据集",
  "englishTerm": "Basic dataset",
  "definition": "数据集定义...",
  "termCategory": "基础术语"
}]
```

## ⚠️ 注意事项

1. **数据完整性**: 所有关联表都有外键约束，删除主记录时需要先处理关联数据
2. **字段验证**: 标准编号需要保证唯一性
3. **文件管理**: 附件删除时需要同步删除物理文件
4. **权限控制**: 所有接口都需要相应权限才能访问
5. **事务管理**: 批量操作使用事务确保数据一致性

## 🔄 扩展功能

### 已实现功能
- ✅ 基础CRUD操作
- ✅ 分页查询支持  
- ✅ 多条件搜索
- ✅ 批量操作支持
- ✅ 权限控制集成
- ✅ API文档自动生成

### 可扩展功能
- 📋 标准资源导入导出
- 📋 标准变更历史记录
- 📋 标准评审流程
- 📋 标准使用统计分析
- 📋 标准到期提醒

---

## 📝 开发说明

本模块严格遵循项目架构规范，采用分层设计确保代码的可维护性和扩展性。所有关键操作都有完善的异常处理和日志记录，生产环境可直接部署使用。