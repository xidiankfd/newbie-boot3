# 标准资源模块开发文档

## 📋 模块概述

标准资源模块(`newbie-standard`)是NewbieBoot3企业管理系统中的核心业务模块，专门用于管理各类标准化文档资源。该模块提供了完整的标准资源生命周期管理功能，包括标准信息管理、附件管理、术语定义、引用关系和解读文档等。

## 🏗️ 模块架构

### 核心组件
- **实体层(Entity)**: 5个核心业务实体
- **数据访问层(Mapper)**: MyBatis-Plus映射器 + 自定义XML映射
- **服务层(Service)**: 业务逻辑实现
- **控制器层(Controller)**: RESTful API接口

### 模块依赖
```
newbie-standard
└── newbie-common (基础模块)
    ├── MyBatis-Plus配置
    ├── Redis缓存配置  
    ├── 统一响应格式
    └── 基础实体类
```

## 📊 数据模型设计

### 1. 标准资源主表 (std_resource)
**核心实体**: `StdResource.java`

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| resourceCode | String | 标准编号 | GB/T 14396-2016 |
| chineseName | String | 中文名称 | 疾病分类与代码 |
| englishName | String | 英文名称 | Disease Classification and Codes |
| standardStatus | String | 标准状态 | 现行/废止/即将实施/被代替 |
| standardType | String | 标准类型 | 国家标准/行业标准/地方标准 |
| standardNature | String | 标准性质 | 强制性/推荐性/指导性技术文件 |
| publishOrganization | String | 发布机构 | 国家卫生健康委员会 |
| standardField | String | 标准领域 | 医疗/医保/医药/公卫/医养/其他 |
| standardClassification | String | 标准分类 | 分类与编码/术语/数据元/接口规范 |

### 2. 标准资源附件表 (std_resource_attachment)  
**核心实体**: `StdResourceAttachment.java`

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| resourceId | String | 关联资源ID | 外键关联 |
| attachmentName | String | 附件名称 | GBT14396-2016疾病分类与代码.pdf |
| attachmentType | String | 附件类型 | PDF文档/图片/表格/压缩包 |
| fileSize | String | 文件大小 | 54.36 MB |
| isMainFile | Boolean | 是否主文件 | true/false |
| downloadUrl | String | 下载链接 | MinIO存储路径 |

### 3. 术语定义表 (std_terminology)
**核心实体**: `StdTerminology.java`

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| resourceId | String | 关联资源ID | 外键关联 |
| termName | String | 术语名称 | 基本数据集 |
| englishTerm | String | 英文对应词 | Basic dataset |
| definition | String | 术语定义 | 详细定义内容 |
| termCategory | String | 术语分类 | 按业务分类 |
| sortOrder | Integer | 排序字段 | 显示顺序 |

### 4. 标准资源引用关联表 (std_resource_reference)
**核心实体**: `StdResourceReference.java`

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| resourceId | String | 标准资源ID | 当前标准 |
| referenceId | String | 引用文件ID | 被引用标准 |
| referenceType | String | 引用类型 | 引用/被引用 |
| referenceName | String | 引用文件名 | WS 363.1 卫生信息数据元目录 |
| sortOrder | Integer | 引用排序 | 显示顺序 |

### 5. 文件解读信息表 (std_interpretation)
**核心实体**: `StdInterpretation.java`

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| resourceId | String | 关联资源ID | 外键关联 |
| sourceType | String | 来源类型 | 文件/网站 |
| sourceTitle | String | 解读标题 | 《疾病控制基本数据集》标准解读 |
| sourceUrl | String | 解读链接 | 下载链接或官方网址 |
| isOfficial | Boolean | 是否官方解读 | true/false |
| viewCount | Integer | 查看次数 | 统计数据 |

## 🔧 核心功能实现

### 1. 数据访问层 (Mapper)

#### 自定义查询方法
**StdResourceMapper.java**
```java
// 根据标准编号查询
StdResource selectByResourceCode(@Param("resourceCode") String resourceCode);

// 根据状态查询
List<StdResource> selectByStatus(@Param("standardStatus") String standardStatus);

// 多条件组合查询
List<StdResource> selectByConditions(@Param("resource") StdResource resource);
```

**StdInterpretationMapper.java**  
```java
// 根据资源ID查询解读列表
List<StdInterpretation> selectByResourceId(@Param("resourceId") String resourceId);

// 查询官方解读
List<StdInterpretation> selectOfficialByResourceId(@Param("resourceId") String resourceId);

// 更新查看次数
void incrementViewCount(@Param("id") String id);
```

#### XML映射文件特性
- **条件查询**: 使用`<if>`标签实现动态SQL
- **批量操作**: 支持批量插入和更新
- **关联查询**: 外键关系维护和级联操作
- **排序机制**: 多字段排序支持

### 2. 服务层 (Service)

#### 标准资源管理服务
**StdResourceService.java**
```java
// 基础CRUD操作
StdResource getById(String id);
boolean save(StdResource stdResource);
boolean updateById(StdResource stdResource);
boolean removeById(String id);

// 业务查询方法
StdResource getByResourceCode(String resourceCode);
List<StdResource> listByStatus(String standardStatus);
IPage<StdResource> pageByConditions(Page<StdResource> page, StdResource resource);
```

#### 附件管理服务
**StdResourceAttachmentService.java**
```java
// 根据资源ID查询附件列表
List<StdResourceAttachment> listByResourceId(String resourceId);

// 获取主文件
StdResourceAttachment getMainFileByResourceId(String resourceId);

// 文件上传处理
boolean uploadAttachment(MultipartFile file, String resourceId);
```

### 3. 控制器层 (Controller)

#### RESTful API设计
**标准资源管理接口**
```java
// 查询接口
GET /standard/resource/{id}           - 根据ID查询
GET /standard/resource/code/{code}    - 根据编号查询  
GET /standard/resource/page           - 分页查询
GET /standard/resource/list           - 列表查询

// 操作接口  
POST /standard/resource               - 新增资源
PUT /standard/resource/{id}           - 更新资源
DELETE /standard/resource/{id}        - 删除资源
```

#### 统一响应格式
```java
// 成功响应
return R.ok(data);

// 失败响应
return R.fail("操作失败", errorCode);

// 分页响应
return R.ok(PageResult.build(page));
```

## 🔐 权限控制

### Sa-Token权限配置
```java
// 控制器权限注解
@PreAuthorize("hasPermission('standard:resource:view')")
@SaCheckPermission("standard:resource:edit")

// 数据权限控制
@DataScope(deptAlias = "d", userAlias = "u")
```

### 权限点设计
```
standard:resource:view    - 查看标准资源
standard:resource:add     - 新增标准资源
standard:resource:edit    - 编辑标准资源  
standard:resource:delete  - 删除标准资源
standard:resource:export  - 导出标准资源
```

## 📱 API接口文档

### 接口分组
- **标准资源管理**: `/standard/resource/**`
- **附件管理**: `/standard/attachment/**`  
- **术语管理**: `/standard/terminology/**`
- **引用关系**: `/standard/reference/**`
- **解读文档**: `/standard/interpretation/**`

### 接口示例

#### 1. 分页查询标准资源
**请求**: `GET /standard/resource/page`

**参数**:
```json
{
    "pageNum": 1,
    "pageSize": 10,
    "resourceCode": "GB/T",
    "chineseName": "疾病",
    "standardStatus": "现行",
    "standardField": "医疗"
}
```

**响应**:
```json
{
    "code": 200,
    "message": "操作成功",
    "data": {
        "records": [...],
        "total": 100,
        "pages": 10
    }
}
```

#### 2. 新增标准资源
**请求**: `POST /standard/resource`

**参数**:
```json
{
    "resourceCode": "GB/T 14396-2024",
    "chineseName": "疾病分类与代码(2024版)",
    "standardStatus": "即将实施",
    "standardType": "国家标准",
    "standardNature": "推荐性",
    "publishOrganization": "国家卫生健康委员会",
    "standardField": "医疗",
    "standardClassification": "分类与编码"
}
```

## 🛠️ 开发规范

### 1. 代码风格
- **实体类**: 使用`@Data`、`@EqualsAndHashCode(callSuper = true)`
- **Mapper接口**: 继承`BaseMapper<T>`，自定义方法用`@Param`注解
- **Service实现**: 继承`ServiceImpl<TMapper, T>`，实现业务接口
- **Controller**: 使用`@RestController`、统一返回`R<T>`类型

### 2. 异常处理
```java
// 业务异常
throw new BusinessException("标准编号已存在");

// 参数验证异常  
@Valid @RequestBody StdResourceDTO dto
```

### 3. 日志记录
```java
// 操作日志
@WebLog(description = "查询标准资源列表")

// 性能监控
@Slf4j - 使用日志框架记录关键操作
```

## 🧪 测试策略

### 1. 单元测试
```java
@SpringBootTest
class StdResourceServiceTest {
    @Test
    void testGetByResourceCode() {
        // 测试根据编号查询标准
    }
    
    @Test  
    void testSaveStdResource() {
        // 测试保存标准资源
    }
}
```

### 2. 集成测试
```java
@AutoConfigureTestDatabase
@Transactional
class StdResourceMapperTest {
    // 测试Mapper层数据访问
}
```

### 3. API测试
使用提供的`标准资源管理接口测试.http`文件进行接口测试。

## 🚀 部署配置

### 1. 数据库配置
执行`开发文档/标准资源模块/标准资源模块-数据库初始化.sql`脚本初始化数据表。

### 2. 模块依赖  
在主模块`newbie-admin`的`pom.xml`中添加依赖:
```xml
<dependency>
    <groupId>com.newbie</groupId>
    <artifactId>newbie-standard</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>
```

### 3. 包扫描配置
确保Spring Boot扫描到标准资源模块的包:
```java
@ComponentScan(basePackages = {"com.newbie"})
@MapperScan("com.newbie.standard.mapper")
```

## 📈 性能优化

### 1. 数据库优化
- **索引设计**: 针对常用查询字段建立复合索引
- **分页查询**: 使用MyBatis-Plus分页插件避免全表扫描
- **缓存策略**: Redis缓存热点数据

### 2. 业务优化
- **批量操作**: 支持批量新增、更新操作
- **异步处理**: 大文件上传使用异步处理
- **数据权限**: 在SQL层面进行数据权限过滤

## 🔧 扩展功能

### 1. 文件存储
- **MinIO集成**: 支持大文件存储和下载
- **文件预览**: PDF、图片在线预览功能  
- **版本管理**: 附件版本控制

### 2. 全文检索
- **Elasticsearch集成**: 支持标准内容全文搜索
- **智能推荐**: 基于用户行为的标准推荐

### 3. 数据同步
- **定时任务**: 定期同步外部标准数据
- **数据校验**: 标准数据完整性检查

## 📋 待优化项

1. **性能优化**: 大数据量分页查询优化
2. **缓存策略**: Redis缓存热点数据设计  
3. **文档生成**: 自动生成标准资源报告
4. **数据分析**: 标准使用情况统计分析
5. **移动端适配**: 响应式设计优化

---

## 📞 技术支持

如有疑问或需要技术支持，请通过以下方式联系：
- **项目文档**: 参考`CLAUDE.md`项目指导文档
- **API文档**: 启动项目后访问Knife4j接口文档
- **测试用例**: 使用项目根目录的`.http`文件进行接口测试